#!/usr/bin/env bash
#    ucaresystem - All-in-one system update and maintenance tool
#    Copyright:
#       2009 Salih Emin <salih@utappia.org>
#       2020 Ioannis Tsagatakis <tsagatakis@protonmail.com>
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, version 3 of the License.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.

base_dir=$(dirname "$0")
# lib_dir will change to point at /usr/lib/ucaresystem during packaging
lib_dir=$(dirname "$0")
# shellcheck source=base
source "${lib_dir}/config"

#
# Show help
#
function ucaresystem_help() {
  cat <<EOF
Usage:
  sudo ucaresystem [options]
  ucaresystem --help|--version

MODES
   -m, --maintain
      Do normal maintenance jobs. The default action id no option is given.
   -c, --clean
      reclaim some disk space
   -u type, --upgrade=type
          Upgrade ...
OTHER OPTIONS
  -n, --dyrun
    Show only the commands, but do not modify the system
  -y, --yes
    Don't ask for confirmation
  -h, --help
    Display this help text
  -v, --version
    Display program version and exits
  -s, --skip
    Do not show the welcome header_text, and do not pause.
  -w, --wait
    Press ENTER to end the program. For the "gui" version
RUNNERS
  --cli
    Run the cli version
  --xterm
    Run the xterm version

#TODO: Fix
EOF
}

#
# Begin script
#

# shellcheck disable=SC2034
info_text="Delegates to cli or gui version."
# shellcheck disable=SC2034
command_line_options=("$@")
# shellcheck disable=SC2034
help_action="ucaresystem_help"
# shellcheck disable=SC2034
manpage="ucaresystem"

basic_setup

dispatch="cli"
for opt in "$@"; do
  case "${opt}" in
  "--cli")
    shift
    ;;
  "--gui")
    dispatch="xterm"
    shift
    ;;
  "--xterm")
    dispatch="xterm"
    shift
    ;;
  esac
done

# Delegate to tool
case "${dispatch}" in
"cli")
  extra_opts=""
  ;;
"xterm")
  extra_opts="--wait"
  ;;
esac

"${lib_dir}/ucaresystem-${dispatch}" "${extra_opts}" "$*"
exit $?
