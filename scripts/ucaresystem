#!/usr/bin/env bash
#    ucaresystem - All-in-one system update and maintenance tool
#    Copyright:
#       2009 Salih Emin <salih@utappia.org>
#       2020 Ioannis Tsagatakis <tsagatakis@protonmail.com>
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, version 3 of the License.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.

set -e
UCARE_VERSION="4.5.0"
lib_dir="."
base_dir=$(dirname "$0")

show_help=false
dispach="cli"

#
# Display version
#
function show_version() {
  echo "$(basename "${0}") version ${UCARE_VERSION}"
  exit
}

#
# Show help
#
function show_help() {
  cat <<EOF
uCareSystem Core $UCARE_VERSION : All-in-one system update and maintenance tool

Usage:
  sudo ucaresystem [options]
  ucaresystem --help|--version

MODES
   -m, --maintain
      Do normal maintenance jobs. The default action id no option is given.
   -c, --clean
      reclaim some disk space
   -u type, --upgrade=type
          Upgrade ...
OTHER OPTIONS
  -n, --dyrun
    Show only the commands, but do not modify the system
  -y, --yes
    Don't ask for confirmation
  -h, --help
    Display this help text
  -v, --version
    Display program version and exits
  -s, --skip
    Do not show the welcome header_text, and do not pause.
  -w, --wait
    Press ENTER to end the program. For the "gui" version
RUNNERS
  --cli
    Run the cli version
  --xterm
    Run the xterm version

See man page for more info
EOF
  exit
}

# Store options
opts=$@

for opt in "$@"; do
  case "${opt}" in
  "--cli")
    shift
    ;;
  "--xterm")
    dispach="xterm"
    shift
    ;;
  "-h" | "--help" )
    show_help
    shift
    ;;
  "-v" | "--version" )
    show_version
    shift
    ;;
  esac
done

# Remove options that already have been handled
delete_options=("--help" "--version" "--cli" "--xterm")
for del in "${delete_options[@]}"; do
   opts=("${opts[@]/${del}}")
done

# Delegate to tool
case "${dispach}" in
"cli")
  "${base_dir}/${lib_dir}"/ucaresystem-cli ${opts[@]}
  exit $?
  ;;
"xterm")
  "${base_dir}/${lib_dir}"/ucaresystem-xterm --wait ${opts[@]}
  exit $?
  ;;
esac

exit 1